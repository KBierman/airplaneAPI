<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Welcome Page</title>
  <script type="text/javascript">
    // Variables
    let authHeaderValue = null;
    let username = null;
    let password = null;

    // Login functions
    function login() {
      // Grab variables
      username = document.getElementById("txtUsername").value;
      password = document.getElementById("txtPassword").value;
      authHeaderValue = "Basic " + btoa(username + ":" + password); // btoa turns it into base64 encoding

      // XMLHttpRequest to send base64 encoded user login information and then stores it in authHeaderValue
      let xmlHttp = new XMLHttpRequest();
      xmlHttp.open('GET', '');
      xmlHttp.setRequestHeader('Authorization', authHeaderValue);
      xmlHttp.onreadystatechange = function () {
        if (this.readyState === XMLHttpRequest.DONE && this.status === 200) {
          document.getElementById("response_message").innerHTML = "Welcome, " + username;
          isUserLoggedIn(false);
          console.log("Login Successful!");
        } else if (this.readyState === XMLHttpRequest.DONE && this.status === 401) {
          document.getElementById("response_message").innerHTML = "Invalid username/password!";
          isUserLoggedIn(true);
          console.log("Login Unsuccessful!")
        }
      }
      xmlHttp.send();
    }

    function readAllCorrespondingFlights() {
      var flightFrom = document.getElementById("txtFrom").value;
      var flightTo = document.getElementById("txtTo").value;
      var departureDate = document.getElementById("txtDepartureDate").value;


      var xmlHttp = new XMLHttpRequest();
      xmlHttp.onreadystatechange = function () {
        if (this.readyState == XMLHttpRequest.DONE && this.status == 200) {
          var flights = JSON.parse(this.responseText);
          console.log("readAllCorrespondingFlights WORKING")
          console.log(flights)
          renderFlights(flights);
        }
      }
      xmlHttp.open("GET", "/api/flight/" + flightFrom + "/" + flightTo + "/" + departureDate, true);
      xmlHttp.send();
    }

    function renderFlights(flights) {
      var flights_list = document.getElementById("displayFlights");
      flights_list.innerHTML = "";
      for(var flight of flights) {
        var flight_html =  "<li>" + "Origin: &nbsp;" + flight.origin +  " Destination: &nbsp;" + flight.destination + " Flight Date: &nbsp;" + flight.flightDate + " Departure Time: &nbsp;" + flight.depTime + " Seats Available: &nbsp;" + flight.seatsEmpty + " Fare: &nbsp;" + flight.fare + "</li>" + "<br>";
        flights_list.innerHTML += flight_html;
      }
    }

  </script>
</head>
<body>
<h1>Welcome to SkyHappy</h1>

<div id="entire page">

  <div id="login_div">
    <h3>Login:</h3>
    <label>Username: </label>
    <input type="text" id="txtUsername" />
    <br/>

    <label>Password: </label>
    <input type="text" id="txtPassword" />
    <br/>

    <button onclick="login();">Login</button>
  </div>

  <div id="loginMsg"> </div>
  <br />

  <div id="flights_lookup">

    <label>From:</label>
    <input type="text" id="txtFrom" />
    <br />
    <label>To:</label>
    <input type="text" id="txtTo" />
    <br />

    <label>Departure Date:</label>
    <input type="text" id="txtDepartureDate" />
    <br />


    <button onclick="readAllCorrespondingFlights();">Find Flights</button>

    <br/>
    <div>
      <ul id="displayFlights" style="list-style-type:none";></ul>
    </div>


  </div>






</div>



</body>
</html>